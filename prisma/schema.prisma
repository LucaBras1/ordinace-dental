// Prisma 7 Schema - Dental Ordinace Booking System
// Database: PostgreSQL with pg adapter
// Generated client: src/generated/prisma

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ENUMS
// ============================================

enum BookingStatus {
  PENDING_PAYMENT  // Čeká na zaplacení kauce
  PAID             // Kauce zaplacena, rezervace potvrzena
  COMPLETED        // Návštěva proběhla
  NO_SHOW          // Pacient nedorazil
  CANCELLED        // Zrušeno (pacientem nebo ordinací)
  REFUNDED         // Kauce vrácena
}

// ============================================
// MODELS
// ============================================

model Service {
  id            String   @id @default(cuid())
  name          String   // "Dentální hygiena", "Bělení zubů", "Air-Flow"
  slug          String   @unique // URL-friendly: "dentalni-hygiena", "beleni-zubu"
  description   String?  @db.Text

  // Ceny v haléřích (CZK * 100) pro přesnost
  price         Int      // Plná cena služby (např. 150000 = 1500 Kč)
  depositAmount Int      // Výše kauce (např. 50000 = 500 Kč)

  duration      Int      // Trvání v minutách (např. 60)
  active        Boolean  @default(true)

  // Pořadí zobrazení (pro custom sorting)
  displayOrder  Int      @default(0)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  bookings      Booking[]

  @@index([slug])
  @@index([active, displayOrder])
  @@map("services")
}

model Booking {
  id              String   @id @default(cuid())

  // Service relation
  serviceId       String
  service         Service  @relation(fields: [serviceId], references: [id], onDelete: Restrict)

  // Customer information
  customerName    String
  customerEmail   String
  customerPhone   String

  // Appointment details
  appointmentDate DateTime @db.Date
  appointmentTime String   // "09:00", "14:30" - stored as string for flexibility

  // Booking status
  status          BookingStatus @default(PENDING_PAYMENT)

  // Payment information
  depositAmount   Int      // Zaplacená kauce v haléřích
  paymentId       String?  // Comgate transaction/payment ID

  // Google Calendar integration
  googleEventId   String?  // ID události v Google Calendar pro synchronizaci

  // Additional information
  notes           String?  @db.Text  // Poznámky od pacienta nebo ordinace
  isFirstVisit    Boolean  @default(true)
  gdprConsent     Boolean  @default(false)

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  cancelledAt     DateTime? // Timestamp zrušení (pro analytics)

  @@index([serviceId])
  @@index([customerEmail])
  @@index([appointmentDate, appointmentTime])
  @@index([status])
  @@index([paymentId])
  @@index([createdAt])
  @@map("bookings")
}
